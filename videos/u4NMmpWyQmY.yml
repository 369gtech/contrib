# Contribution guide: https://github.com/watch-devtube/contrib

# speaker:
#   name: _____
#   twitter: _____ # mandatory twitter handle; must not include @

# tags: [____, _____, _____]

tags:
    - startup
    - security
    - sap
title: '#HITBLockdown002 D2T1 - SAP RCE : The Agent Who Spoke Too Much - Yvan GENUER'
language: English
recordingDate: 1598496708
description: "1. Introduction\n\n\n\nA quick introduction of the presenter, followed by an overview of SAP Applications, SAP Solution Manager (SOLMAN) and SAP SMDAgent. We will also introduce the importance and relevance of all these specific components.\n\n\n2. Why did we look at this component ?\n\n\nIn this brief overview, we show that one of the most important security files of this component is encoded in base64 by default, which provided additional hints to continue learning deeper into this application.\n\n\n3. Authentication Bypass\n\n\nJust after startup, the Agent initiates communication between the SOLMAN and itself.\nIn this section we describe a way to hijack this communication by bruteforcing protocol fields based on time. An anonymous attacker could remotely execute any Agent function through this communication.\n\n\n4. OS Command Whitelist Bypass\n\n\nOne of the Agent’s functions, called ‘remoteOS’, allows an authenticated SOLMAN user to remotely execute an OS Command on an Agent host as Agent administrator. This particular function uses only predetermined OS Commands, as well blacklists some characters. We will describe how an attacker could bypass these protections and execute arbitrary commands.\n\n\n5. Privilege Escalation to the complete SAP landscape\n\n\nThe Agent handles, in an encrypted configuration file, several critical credentials for SOLMAN. We will explain and demonstrate how an attacker could decrypt this configuration file and how these credentials could be mis-used to eventually achieve unauthorized SAP Administrator privileges on all SAP systems connected to the SAP Solution Manager.\n\n\nDemo #1 Full chain attack. Where remote attacker bypass authentication, execute OS command then decrypt configuration file to exfiltrate SOLMAN credentials.\n\n\n6. Tamper the SOLMAN Security Report\n\n\nSAP Solution Manager handles a lot of technical features for SAP administrator. One of them, called ‘System Recommendations’, it is used to automatically calculate missing security patches for all SAP Systems in the landscape. As a real post-exploitation example, we will explain how an attacker, by exploiting the previous shown vulnerabilities, could be able to trick this feature to make it avoid showing missing critical security patches.\n\n\nDemo #2 Hiding hundreds security patches from SOLMAN Report.\n\n\n7. Silent the Agent\n\n\nWe will provide details on all patches and will describe configuration recommendations to mitigate the presented vulnerabilities so organizations can protect their SAP landscape against these threats.\nCVE-2019-0330, CVE-2019-0318, CVE-2019-0307, CVE-2019-0291\n\n\n8. Conclusions\n\n\nWe will provide final conclusions on how to address cybersecurity for SAP Applications across the enterprise, thanks and opening to questions.\n\n\n=== \n\n\nYvan Genuer is a Sr. Security Researcher at Onapsis. He has over 15 years of SAP experience. He has been delivering consultancy services around SAP Security as well as researching for vulnerabilities into SAP products, resulting in SAP AG official acknowledgements he has received, for several vulnerabilities he originally reported. Furthermore, he has also conducted both trainings and talks about this topic in conferences."
