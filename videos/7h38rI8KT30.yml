# Contribution guide: https://github.com/watch-devtube/contrib

# speaker:
#   name: _____
#   twitter: _____ # mandatory twitter handle; must not include @

# tags: [____, _____, _____]

title: 'DEF CON 29 - Tianze Ding - Vulnerability Exchange: One Domain Account For More Than Exchange Server'
language: English
recordingDate: 1628184905
description: "Microsoft Exchange Server is one of the most famous mail servers in the world. It not only stores a large amount of sensitive corporate information, but also plays an important role in Microsoft Active Directory, so it has become a high-value target for both APT groups and red teams.\n\nIn the past few months, some high-risk vulnerabilities in Exchange Server have been exposed, which mainly target vulnerable ASP.NET code. But the architecture of Exchange Server is complicated, and its attack surface is not limited to ASP.NET, this talk will analyze and attack Exchange Server from a different perspective.\n\nI will share the following two new vulnerabilities I found, as well as the new attack surfaces and how I chained several techniques to successfully exploit them in detail.\n\n1. One of them can result in arbitrary mailbox takeover, attackers can read emails, download attachments, send emails, etc. as any Exchange user.\n\n2. The other can lead to remote code execution on Exchange Server, attackers can gain local administrator privileges and execute arbitrary commands. Furthermore, there is an interesting point, even if you have applied the latest Exchange Server patches, your Exchange Server may still be compromised by this type of attack.\n\nFor red teams, Exchange Server RCE is only the beginning. Usually, there are some high-privileged domain users and groups on Exchange Server, I will also introduce a new method in depth to help you perform lateral movement and even privilege escalation to Domain Admin after achieving Exchange Server RCE.\n\nThese vulnerabilities have been reported to MSRC and the exploit tools will be released after the talk.\n\nReferences:\n[1] https://www.zerodayinitiative.com/blog/2018/12/19/an-insincere-form-of-flattery-impersonating-users-on-microsoft-exchange\n[2] https://www.slideshare.net/harmj0y/derbycon-the-unintended-risks-of-trusting-active-directory\n[3] https://docs.microsoft.com/en-us/exchange/client-developer/web-service-reference/ews-operations-in-exchange\n[4] https://github.com/quickbreach/ExchangeRelayX\n[5] https://blog.compass-security.com/2020/05/relaying-ntlm-authentication-over-rpc/\n[6] https://www.crowdstrike.com/blog/cve-2021-1678-printer-spooler-relay-security-advisory/\n[7] https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rpce/425a7c53-c33a-4868-8e5b-2a850d40dc73\n[8] https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/\n[9] https://github.com/SecureAuthCorp/impacket\n[10] https://github.com/gdedrouas/Exchange-AD-Privesc\n[11] https://labs.f-secure.com/tools/sharpgpoabuse/"
